<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Arne Blankerts <arne@blankerts.de> and contributors" /><link rel="canonical" href="https://docs.templado.io/migrate/templado4/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Templado 4.x - Templado Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link href="../../highlight/github.min.css" rel="stylesheet" />
        <link href="../../css/templado.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Templado 4.x";
        var mkdocs_page_input_path = "migrate/templado4.md";
        var mkdocs_page_url = "/migrate/templado4/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../img/templado-logo.svg" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../install/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../first-steps/">First Steps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/view-model/">View Model Rendering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/form-handling/">Form Handling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/merge/">Merging Documents</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/transformation/">Applying Transformations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/serializing/">Controlling the Serializing</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Extending Templado</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../extend/transformations/">Creating Transformations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../extend/filters/">Creating Filters</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../extend/selectors/">Creating Selectors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../extend/serializers/">Custom Serialization</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Migration</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Templado 4.x</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#updated-and-changed-requirements">Updated and Changed Requirements</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#loading-facade-templado-removed">Loading Facade Templado removed</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dealing-with-potential-parse-errors">Dealing with potential parse errors</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#everything-is-a-document-now">Everything is a Document now</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#migrating-snippets">Migrating Snippets</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#merging-documents-instead-of-applying-snippets">Merging Documents instead of Applying Snippets</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#snippet-document-namespace-changed">Snippet Document Namespace changed</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#todo">TODO</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Resources</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://templado.io">Project Homepage</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/templado/engine">Source Code</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/templado/engine/issues">Issue Tracker</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Templado Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Migration</li>
      <li class="breadcrumb-item active">Templado 4.x</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/templado/documentation/blob/main/src/migrate/templado4.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="migration-from-templado-4x">Migration from Templado 4.x</h2>
<p>In general, migrating from Templado 4.x to Templado 5.0 should be pretty straight forward. The general concepts as well as APIs are mostly kept identical or got enhanced in a backwards compatible way.</p>
<p>The main changes are:</p>
<ul>
<li>Requires PHP 8.2+</li>
<li><code>HTML</code> and <code>Snippet</code> got logically merged into a <code>Document</code>, representing both types</li>
<li>A new <code>HTMLSerializer</code> has been introduced to generate HTML 5 output</li>
<li>ViewModels now can have<ul>
<li>public properties to satisfy the rendering needs</li>
<li>return a signal instance rather than relying on bool types and null</li>
</ul>
</li>
<li>Form data handling now supports nested structures as well as fields referenced by id</li>
<li>A <code>Selector</code> can now be used in more cases to specify what areas of a document to apply the change to</li>
<li>Optionally <code>vocab</code> aware</li>
<li>Enhanced trace output in case of errors</li>
<li>Snapshot support</li>
</ul>
<p>The following paragraphs give more in-depth details on these changes.</p>
<h3 id="updated-and-changed-requirements">Updated and Changed Requirements</h3>
<p>In contrast to Templado 4, which was designed to work with PHP 7+, Templado 5 requires PHP 8.2 and later. Additionally, as Templado 5 ships with an enhanced custom HTML 5 Serializer implementation, a new requirement to <code>ext/xmlwriter</code> has been added.</p>
<h3 id="loading-facade-templado-removed">Loading Facade <code>Templado</code> removed</h3>
<p>In Templado 4.x and earlier, a facade named <code>Templado</code> existed providing static factory methods to create <code>HTML</code> instances from files or strings. This extra facade was deemed superfluous and got removed.</p>
<p>It's functionality got, in part, replaced by <code>Document::fromString</code>. Templado 5 no longer performs any file loading operations itself, so the class <code>FileName</code> got removed.</p>
<p>This means the following calls would need to get changed from</p>
<pre><code class="language-php">$html1 = Templado::loadHTMLFile(new FileName(...));

$html2 = Templado::parseHtmlString(...);
</code></pre>
<p>to</p>
<pre><code class="language-php">$html1 = Document::fromString(file_get_contents(...));

$html2 = Document::fromString(...);
</code></pre>
<p>This should be a simple search-and-replace refactoring.</p>
<h3 id="dealing-with-potential-parse-errors">Dealing with potential parse errors</h3>
<p>As Templado 5 does no longer provide a loading facade, the respective exceptions are also gone. If you want to catch any issues with parsing when using the <code>Document::fromString</code> method you can now explicitly catch <code>Templado\Engine\ParsingException</code> rather than the old rather generic <code>TempladoException</code>. To learn the details on what actually went wrong, you can ask the exception instance object for the <code>LibXMLError</code> instances using <code>Templado\Engine\ParsingException::errors()</code>.</p>
<h3 id="everything-is-a-document-now">Everything is a <code>Document</code> now</h3>
<p>In Templado 4.x and earlier, every rendering operation could be applied on a document using the <code>HTML</code> facade object - optionally created by the aforementioned factory facade. To support merging fragments into documents, the concept of so-called snippets existed, represented by multiple types of <code>Snippet</code> classes. In a nutshell, these merely served as a glorified transfer object and implemented different strategies on how the merge should be performed.</p>
<p>This concept turned out to be rather impractical, hard to understand and limiting in practical use, so for Templado 5, the concept of a snippet being different from an HTML document got dropped. Everything is now a <code>Document</code>, regardless whether it represents a complete HTML structure or merely a fragment.</p>
<p>Accordingly, throught a code base using Templado 4, all type declarations need to get changed from <code>HTML</code> or <code>Snippet</code> to <code>Document</code>.</p>
<h4 id="migrating-snippets">Migrating Snippets</h4>
<p>To migrate from Templado 4, all explicit calls to load or instantiate a Snippet need to get replaced by calls to <code>Document</code> and the best matching factory method. As already mentioned, Templado no longer performs filesystem operations itself. This means, the previously existing <code>SnippetLoader</code> used in the following example to create <code>$snippet3</code> has been removed:</p>
<pre><code class="language-php">$snippet1 = new \Templado\Engine\SimpleSnippet('some-id', $dom);

$snippet2 = new \Templado\Engine\TempladoSnippet('some-id', $dom);

$snippet3 = (new SnippetLoader)-&gt;load(new FileName('...'), 'optionally-id-here');
</code></pre>
<p>For merging of documents (or previously snippets), the to-be-merged objects must have an ID set. To ensure the syntactical validity according to W3C rules, a new value object <code>Id</code> got introduced and replaces the scalar string type used before.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In Templado 4 when using the <code>SnippetLoader</code>, providing an ID was optional. If none was given, Templado's loader implementation checked whether an ID was set as an attribute on the root element within the loaded document and extracted it from there. As the loader functionality got removed, this is technically no longer possible. The implicit assignment of the ID from content was confusing at best, and, unfortunately, a common source for errors. </p>
</div>
<p>The above code examples should thus be replaced as follows:</p>
<pre><code class="language-php">$snippet1 = \Templado\Engine\Document::fromDomDocument($dom, new Id('some-id'));

$snippet2 = \Templado\Engine\Document::fromDomDocument($dom, new Id('some-id'));

$snippet3 = \Templado\Engine\Document::fromString(
    file_get_contents('...'), 
    new Id('no-longer-optional-id-here')
);
</code></pre>
<h4 id="merging-documents-instead-of-applying-snippets">Merging Documents instead of Applying Snippets</h4>
<p>As the technically separate concept of a Snippet got dropped, the API to get fragments into a (main) document got renamed from <code>applySnippets</code> to <code>merge</code>.</p>
<p>This change allows to also merge "fragments" into each other as they also are now just a <code>Document</code>.</p>
<p>Furthermore, the API got enhanced to allow for passing one or more <code>Document</code> instances directly, without the explicit need for a collection of documents:</p>
<pre><code class="language-php">$html = Templado::parseHtmlString(...);

$list = new SnippetListCollection();
$list-&gt;addSnipet(...);
$list-&gt;addSnipet(...);

$html-&gt;applySnippets($list);
</code></pre>
<p>Due to the API change, the above code can be adjusted as follows: </p>
<pre><code class="language-php">$document = Document::fromString('...');
$document-&gt;merge(
   Document::fromString('...', new Id('...')),
   Document::fromString('...', new Id('...'))
);
</code></pre>
<p>Of course, alternatively using a collection is still a valid option as well:</p>
<pre><code class="language-php">$document = Document::fromString('...');

$list = new DocumentCollection();
$list-&gt;add(Document::fromString('...', new Id('...')));
$list-&gt;add(Document::fromString('...', new Id('...')));

$document-&gt;merge($list);
</code></pre>
<h4 id="snippet-document-namespace-changed">Snippet Document Namespace changed</h4>
<p>Snippets in Templado 4 optionally support having a wrapper element to ensure xml compliance when otherwise multiple root elements would exist:</p>
<pre><code class="language-xml">&lt;templado:snippet xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:templado=&quot;https://templado.io/snippet/1.0&quot;&gt;
 &lt;h1&gt;Title&lt;/h1&gt;
 &lt;p&gt;text here&lt;/p&gt;
&lt;/templado:snippet&gt;
</code></pre>
<p>Templado 5.0 documents provide the same option, but use a different namespace as the id lookup mechanism is no longer supported. The root element name in Templado 5 defaults to "document" but is technically irrelevant as only the namespace is currently checked upon merge.</p>
<pre><code class="language-xml">&lt;templado:document xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:templado=&quot;https://templado.io/document/1.0&quot;&gt;
 &lt;h1&gt;Title&lt;/h1&gt;
 &lt;p&gt;text here&lt;/p&gt;
&lt;/templado:snippet&gt;
</code></pre>
<hr />
<h3 id="todo">TODO</h3>
<pre><code>Transformation::getSelector =&gt; Transformation::selector

HTML::asString() =&gt; Document::asString(new HTMLSerializer)
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../extend/serializers/" class="btn btn-neutral float-left" title="Custom Serialization"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright &copy; 2023, Arne Blankerts and contributors</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/templado/documentation" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../../extend/serializers/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../highlight/highlight.min.js"></script>
      <script src="../../highlight/all.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
