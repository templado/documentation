<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Arne Blankerts <arne@blankerts.de> and contributors" /><link rel="canonical" href="https://docs.templado.io/features/view-model/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>View Model Rendering - Templado Documentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link href="../../highlight/github.min.css" rel="stylesheet" />
        <link href="../../css/templado.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "View Model Rendering";
        var mkdocs_page_input_path = "features/view-model.md";
        var mkdocs_page_url = "/features/view-model/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../img/templado-logo.svg" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../install/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../first-steps/">First Steps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">View Model Rendering</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#using-rdfa">Using RDFa</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#how-rendering-works">How rendering works</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#implementing-a-view-model">Implementing a View Model</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#understood-rdfa-attributes">Understood RDFa Attributes</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#vocab">vocab</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#property">property</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#supported-return-types">Supported Return Types</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#operating-on-html-attributes">Operating on HTML Attributes</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#resource">resource</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#prefix">prefix</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#typeof">typeof</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../form-handling/">Form Handling</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../merge/">Merging Documents</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../transformation/">Applying Transformations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../serializing/">Controlling the Serializing</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Extending Templado</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../extend/transformations/">Creating Transformations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../extend/filters/">Creating Filters</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../extend/selectors/">Creating Selectors</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../extend/serializers/">Custom Serialization</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Migration</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../migrate/templado4/">Templado 4.x</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Resources</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://templado.io">Project Homepage</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/templado/engine">Source Code</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/templado/engine/issues">Issue Tracker</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Templado Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
          <li>Features &raquo;</li>
      <li class="breadcrumb-item active">View Model Rendering</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/templado/documentation/blob/main/src/features/view-model.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="view-models">View Models</h2>
<h3 id="introduction">Introduction</h3>
<p>Probably the most essential feature of any templating engine is a means to easily transform a data structure into HTML using, well, a template. There seem to be almost endless ways to define the view logic: From rather limited approaches like merely replacing placeholders, to defining a complete domain specific language. </p>
<p>While details of course differ, interestingly enough, most engines seem to agree on embedding the view logic into the template, mixing HTML and custom markup or language constructs into a single file. For rendering, the data is mapped from simple DTOs, xml, json, or - most frequently - associative arrays.</p>
<p>These approaches have a tendency to become a mess quickly, being hard to test and to reason about. Wouldn't it be much nicer to have standard HTML files, ready to preview at any time and otherwise controlling the rendering process from outside the template?</p>
<h4 id="using-rdfa">Using RDFa</h4>
<p>Instead of mixing view logic with markup by embedding instructions into the HTML for a clean separation of concerns, we'd want the logic part to be outside the markup. Yet, for a templating engine to understand how and where to operate, some sort of reference information needs to be provided nevertheless. The best way to do this is by enriching the HTML with structuring metadata, giving the HTML a semantic structure and providing meaning beyond the markup required for a browser to render it:</p>
<pre><code class="language-html">&lt;section property=&quot;author&quot;&gt;
    &lt;h3 property=&quot;name&quot;&gt;John Doe&lt;/h3&gt;
    &lt;a property=&quot;email&quot; typeoOf=&quot;business&quot; href=&quot;mailto:john@example.org&quot;&gt;E-Mail me&lt;/a&gt;
&lt;/section&gt;
</code></pre>
<p>The above HTML fragment has been annotated with <a href="https://www.w3.org/TR/html-rdfa/">RDFa</a> attributes. In this case, only the <code>property</code> attribute has been used though. When following the tree structure, one can now understand that the text content of the "h3" element contains the <code>name</code> of an <code>author</code> and that his <code>business</code> <code>email</code> address is "john@example.org".</p>
<p>Instead of reinventing the wheel and coming up with a proprietary set of attributes, Templado makes use of these attributes to map data from a View Model into the HTML. This is done by calling the relevant method from or by accessing a public property of the given view model. Depending on the returned type, Templado will decide what to do next. </p>
<h4 id="how-rendering-works">How rendering works</h4>
<p>The view model renderer operates on the internal DOM representation of the template: Starting from the root element - also called <code>DocumentElement</code> -, Templado iterates over all its children and also follows the paths down each respective subtree recursively. Whenever one of the RDFa attributes <a href="#vocab">vocab</a>, <a href="#property">property</a> or <a href="#typeof">typeof</a> is encountered, the method associated with it will get called on the current view model context. If the returned value for a <code>property</code> triggered call happens to be an object, it's considered a view model and thus replaces the view model for the current tree position and all their nested elements - until potentially overwritten by yet another view model. This effectively allows for walking down the document tree.</p>
<p>This probably is best explained with an example. Let's assume this very basic HTML fragment is our template:</p>
<pre><code class="language-html">&lt;article property=&quot;article&quot;&gt;
    &lt;h1&gt;Article Headline&lt;/h1&gt;    
    &lt;section property=&quot;intro&quot;&gt;
        &lt;h2&gt;Headlaine without property attribute&lt;/h2&gt;
        &lt;p property=&quot;content&quot;&gt;This is the default text&lt;/p&gt;
    &lt;/section&gt;
&lt;/body&gt;
</code></pre>
<p>The above example contains a html fragment with a nested structure. While there could be any number of elements in between, basically only the <code>property</code> attributes - or rather their respective values - are relevant in this example for the model nesting. Walking down the tree, the nesting is <code>article &gt; intro &gt; content</code>. That means, we initially need a view model we can call <code>article()</code> on. As we're having a nested structure and want to walk down the tree, we need <code>article()</code> to return an object. On the returned object, Templado will call <code>intro()</code>. That's because the next element with a property attribute found while walking down the tree is the <code>section</code> element and the <code>property</code>'s value is "intro". Given we want to continue walking the tree, this method should also return an object. We again turn it into a context view model. The next element with a <code>property</code> attribute is the <code>p</code> element. Templado thus calls <code>content()</code> on the current view model, which is the one returned from <code>intro()</code> before. Assuming we want to set the text of the <code>p</code> element, we want that method to return a string.</p>
<p>Expressed in PHP code, this could look like this:   </p>
<pre><code class="language-php">class MyRootViewModel {
    public function article(): Article {
        return new Article();
    }
}

class Article {
    public function section(): Section {
        return new Section();
    }
}

class Section {
    public function p(): string {
        return 'View Model text for p element here';
    }
}
</code></pre>
<p>Given the required methods do not conflict, and we do not have any need for actual view logic other than the nesting, we could - for this very simple example at least - put all this into a single view model class:</p>
<pre><code class="language-php">class MyRootViewModel {
    public function article(): self {
        return $this;
    }
    public function section(): self {
        return $this;
    }
    public function p(): string {
        return 'View Model text for p element here';
    }    
}
</code></pre>
<p>So in other words: By default, the document structure and the placement of <code>property</code> attributes mainly define the required nesting of view models. Of course there are exceptions to every rule and Templado provides two means to avoid or rather break out of the nesting: By using a <a href="#prefix">prefix</a> or by specifying a <a href="#resource">resource</a>. Please refer to the respective paragraph for more details on those.</p>
<h3 id="implementing-a-view-model">Implementing a View Model</h3>
<p>To be used as a Templado View Model the implementing class generally is not required to fulfill any Templado specific interface, as you might have guessed given the above examples. While that may seem odd from an object-oriented programming perspective, the methods or properties that need to be provided highly depend on the HTML markup and the used RDFa annotations. From Templado's perspective, there is nothing specific enough to require it in terms of an interface. All we need is it to be an object.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Many templating engines accept nested associative arrays as models, what other programming languages call a dictionary. As PHP unfortunately does not differentiate between lists and dictionaries, it is close to impossible to reliably tell whether the key and its value are supposed to be relevant or should be rather ignored. It was thus a deliberate design decision to <strong>not</strong> support associative arrays as models. Templado treats everything that is iterable as a list to iterate over, ignoring potential keys and their values.</p>
</div>
<p>If all you have is an associative array, you could build a simple object wrapper around it using PHP's magic method <code>__get</code>:</p>
<pre><code class="language-php">class ArrayToObjectWrapper {
    public function __construct(private array $data) {}

    public function __get(string $key): mixed {
        if (!array_key_exists($key, $this-&gt;data)) {
            return null;
        }

        $value = $this-&gt;data[$key];

        if (!is_array($value)) {
            return $value;
        }

        if (array_is_list($value)) {
            return $value;
        }

        return new self($value);
    }
}
</code></pre>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The above wrapper example uses <a href="https://www.php.net/manual/en/function.array-is-list.php"><code>array_is_list</code></a> to determine whether the array provided is a dictionary or a list. PHP considers an array a list if its keys consist of consecutive numbers from 0 to count($array)-1. This may not apply to your data structure and thus could be unreliable.  </p>
</div>
<h3 id="understood-rdfa-attributes">Understood RDFa Attributes</h3>
<p>While the RDFa standard contains a lot of attributes, Temoplado only looks for a small subset when performing its rendering work. This section describes which attributes are understood, and what the expected behaviour of the view model is for each.</p>
<h4 id="vocab">vocab</h4>
<p>RDFa in HTML is an open standard to semantically enhance markup. To make sense of a set of RDFa nodes, they commonly get semantically grouped into so-called vocabularies. Think of a class or even multiple classes grouping various properties into a meaningful <em>something</em>. This <em>something</em> would be your vocabulary in RDFa's terminology.</p>
<p>Of course not all vocabularies are yours and thus most are not relevant for view model rendering. So in case your template contains RDFa attributes from other vocabularies, Templado needs to get told which ones to operate on.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you do not include third party vocabularies in your templates, you do not need to set the <code>vocab</code> attribute nor implement support into your view model.</p>
</div>
<p>Whenever a <code>vocab</code> attribute is encountered while walking down the DOM tree, Templado checks whether the current view model implements a <code>vocab()</code> method. If not, the attribute is ignored. Otherwise, Templado will call the method, passing in the value of the <code>vocab</code> attribute. The return value is expected to be a string that Templado then can compare against the specified vocab - as in, the value of the vocab attribute. If they match, Templado considers the view model to be responsible for this vocabulary and will try to render it.</p>
<p>Again, this is probably best understood with an example. A simple HTML fragment, that has a <code>vocab</code> attribute set could look like this:</p>
<pre><code class="language-html">&lt;p vocab=&quot;https://example.com#book&quot;&gt;Hello world&lt;/p&gt;
</code></pre>
<p>To specify a view model that is considered responsible for this vocabulary, various options exist. All the following examples lead to the same result.</p>
<pre><code class="language-php">class MyRootModel {
    public function vocab(string $requested): string {         
        return $requested;
    }
}
</code></pre>
<pre><code class="language-php">class MyRootModel {
    public function vocab(): string {
        return &quot;https://example.com#book&quot;;
    }
}
</code></pre>
<pre><code class="language-php">class MyRootModel {
    public string $vocab = &quot;https://example.com#book&quot;;
}
</code></pre>
<p>If you want to <strong>not</strong> have the view model be applied, you have to return a none-matching string. So if the requested vocabulary would for instance be "https://schema.org", the last two examples above would already qualify as not being responsible.</p>
<p>The first example simply returns the input string and thus would always be considered responsible. The implementation could just as well be removed as it's technically identical to <em>not</em> having a <code>vocab()</code> method at all - but some prefer to make it explicit.</p>
<h4 id="property">property</h4>
<h5 id="supported-return-types">Supported Return Types</h5>
<h6 id="string">String</h6>
<h6 id="signalignore-or-true">Signal::ignore (or true)</h6>
<h6 id="signalremove-or-false">Signal::remove (or false)</h6>
<h6 id="iterables-eg-arrays-or-iterator">Iterables (e.g. Arrays or Iterator)</h6>
<h6 id="view-model-objects">View Model Objects</h6>
<h5 id="operating-on-html-attributes">Operating on HTML Attributes</h5>
<p>Apart from setting the text content of an element, Templado supports changing the value of or entirely removing existing attributes. Templado will <em>not</em> add new attributes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To not break Templado's flow of operation, the supported RDFa attributes are protected and can <strong>not</strong> be changed or removed using a view model. If you prefer to have RDFa attributes removed at the end of processing, this can be achieved by using the <a href="../serializing/">Serliazer</a>.</p>
</div>
<h6 id="supported-types-for-attribute-rendering">Supported Types for Attribute Rendering</h6>
<h6 id="string_1"># String</h6>
<h6 id="signalignore-or-true_1"># Signal::ignore (or true)</h6>
<h6 id="signalremove-or-false_1"># Signal::remove (or false)</h6>
<h4 id="resource">resource</h4>
<h4 id="prefix">prefix</h4>
<h4 id="typeof">typeof</h4>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../first-steps/" class="btn btn-neutral float-left" title="First Steps"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../form-handling/" class="btn btn-neutral float-right" title="Form Handling">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright &copy; 2023, Arne Blankerts and contributors</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/templado/documentation" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../../first-steps/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../form-handling/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../highlight/highlight.min.js"></script>
      <script src="../../highlight/all.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
